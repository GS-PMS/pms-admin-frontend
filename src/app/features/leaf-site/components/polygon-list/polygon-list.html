<div class="polygon-list" id="polygon-list-container">
  <div class="polygon-list__header">
    <h2 class="polygon-list__title" id="polygon-list-title">Polygons</h2>
    <button
      type="button"
      class="polygon-list__btn polygon-list__btn--primary"
      id="add-polygon-btn"
      (click)="toggleAddForm()"
      [disabled]="showAddForm()"
    >
      Add Polygon
    </button>
  </div>

  @if (showAddForm()) {
  <div class="polygon-list__add-form" id="add-polygon-form-container">
    <form [formGroup]="polygonGroup" (ngSubmit)="submitPolygon()" id="add-polygon-form">
      @if (errorMessage()) {
      <div class="polygon-list__error-banner" id="polygon-form-error">
        {{ errorMessage() }}
      </div>
      }

      <app-polygon-form [polygonGroup]="polygonGroup" [polygonIndex]="0" [canRemove]="false" />

      <div class="polygon-list__form-actions">
        <button
          type="button"
          class="polygon-list__btn polygon-list__btn--outline"
          id="cancel-polygon-btn"
          (click)="cancelAdd()"
          [disabled]="isSubmitting()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="polygon-list__btn polygon-list__btn--primary"
          id="save-polygon-btn"
          [disabled]="isSubmitting()"
        >
          @if (isSubmitting()) { Saving... } @else { Save Polygon }
        </button>
      </div>
    </form>
  </div>
  } @if (polygons().length === 0) {
  <div class="polygon-list__empty" id="polygon-list-empty">
    <p>No polygons defined for this site</p>
  </div>
  } @else {
  <div class="polygon-list__items" id="polygon-list-items">
    @for (polygon of polygons(); track $index; let polyIndex = $index) {
    <div class="polygon-item" [id]="'polygon-item-' + polyIndex">
      <div class="polygon-item__header">
        <h3 class="polygon-item__name" [id]="'polygon-name-' + polyIndex">{{ polygon.name }}</h3>
      </div>

      <div class="polygon-item__details">
        <div class="polygon-item__detail">
          <span class="polygon-item__label">Polygon Points:</span>
          <span class="polygon-item__value" [id]="'polygon-points-count-' + polyIndex"
            >{{ polygon.polygonPoints.length }} points</span
          >
        </div>
      </div>

      <div class="polygon-item__polygonpoints" [id]="'polygon-points-' + polyIndex">
        <div class="polygonpoints-list">
          @for (coord of polygon.polygonPoints; track $index; let pointIndex = $index) {
          <div class="polygonpoint-item" [id]="'polygon-' + polyIndex + '-point-' + pointIndex">
            <span class="polygonpoint-item__index">{{ pointIndex + 1 }}</span>
            <span
              class="polygonpoint-item__lat"
              [id]="'polygon-' + polyIndex + '-point-' + pointIndex + '-lat'"
              >Lat: {{ coord.latitude.toFixed(6) }}</span
            >
            <span
              class="polygonpoint-item__lng"
              [id]="'polygon-' + polyIndex + '-point-' + pointIndex + '-lng'"
              >Lng: {{ coord.longitude.toFixed(6) }}</span
            >
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  }
</div>
