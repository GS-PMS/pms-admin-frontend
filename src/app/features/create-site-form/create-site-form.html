<section class="create-site-form">
  <div class="create-site-form__header">
    <h1 class="create-site-form__title">{{ 'createSiteForm.title' | translate }}</h1>
    <p class="create-site-form__subtitle">
      {{ 'createSiteForm.addingSiteUnder' | translate }}
      <strong id="site-path">{{ currentPath }}</strong>
    </p>
  </div>

  @if (submitSuccess()) {
  <div class="form-alert form-alert--success" id="success-msg">
    {{ 'createSiteForm.successMessage' | translate }}
    <button type="button" class="btn btn--primary btn--sm" id="nav-btn" (click)="navigateBack()">
      {{ 'createSiteForm.goToSites' | translate }}
    </button>
  </div>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="create-site-form__form">
    <div class="form-section">
      <h2 class="form-section__title">{{ 'createSiteForm.basicInfo' | translate }}</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="nameEn" class="form-label"
            >{{ 'createSiteForm.nameEn' | translate }} <span class="required">*</span></label
          >
          <input
            type="text"
            id="nameEn"
            formControlName="nameEn"
            class="form-input"
            [class.form-input--error]="isFieldInvalid('nameEn')"
            [placeholder]="'createSiteForm.placeholders.nameEn' | translate"
          />
          @if (isFieldInvalid('nameEn')) {
          <span class="form-error" id="nameEn-error">
            @if (form.get('nameEn')?.errors?.['required'] ||
            form.get('nameEn')?.errors?.['whitespaceOnly']) {
            {{ 'createSiteForm.errors.nameEnRequired' | translate }} } @else if
            (form.get('nameEn')?.errors?.['minlength'] || form.get('nameEn')?.errors?.['maxlength'])
            { {{ 'createSiteForm.errors.nameEnLength' | translate }} } @else if
            (form.get('nameEn')?.errors?.['englishOnly']) {
            {{ 'createSiteForm.errors.nameEnEnglishOnly' | translate }} }
          </span>
          }
        </div>

        <div class="form-group">
          <label for="nameAr" class="form-label"
            >{{ 'createSiteForm.nameAr' | translate }} <span class="required">*</span></label
          >
          <input
            type="text"
            id="nameAr"
            formControlName="nameAr"
            class="form-input"
            [class.form-input--error]="isFieldInvalid('nameAr')"
            [placeholder]="'createSiteForm.placeholders.nameAr' | translate"
            dir="rtl"
          />
          @if (isFieldInvalid('nameAr')) {
          <span class="form-error" id="nameAr-error">
            @if (form.get('nameAr')?.errors?.['required'] ||
            form.get('nameAr')?.errors?.['whitespaceOnly']) {
            {{ 'createSiteForm.errors.nameArRequired' | translate }} } @else if
            (form.get('nameAr')?.errors?.['minlength'] || form.get('nameAr')?.errors?.['maxlength'])
            { {{ 'createSiteForm.errors.nameArLength' | translate }} } @else if
            (form.get('nameAr')?.errors?.['arabicOnly']) {
            {{ 'createSiteForm.errors.nameArArabicOnly' | translate }} }
          </span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="integrationCode" class="form-label"
            >{{ 'createSiteForm.integrationCode' | translate }}
            <span class="required">*</span></label
          >
          <input
            type="text"
            id="integrationCode"
            formControlName="integrationCode"
            class="form-input"
            [class.form-input--error]="isFieldInvalid('integrationCode')"
            [placeholder]="'createSiteForm.placeholders.integrationCode' | translate"
          />
          @if (isFieldInvalid('integrationCode')) {
          <span class="form-error" id="integrationCode-error">
            @if (form.get('integrationCode')?.errors?.['required'] ||
            form.get('integrationCode')?.errors?.['whitespaceOnly']) {
            {{ 'createSiteForm.errors.integrationCodeRequired' | translate }} } @else if
            (form.get('integrationCode')?.errors?.['minlength'] ||
            form.get('integrationCode')?.errors?.['maxlength']) {
            {{ 'createSiteForm.errors.integrationCodeLength' | translate }} } @else if
            (form.get('integrationCode')?.errors?.['codeValidation']) {
            {{ 'createSiteForm.errors.integrationCodeFormat' | translate }} }
          </span>
          }
        </div>

        <div class="form-group">
          <label for="path" class="form-label">{{ 'createSiteForm.path' | translate }}</label>
          <input
            type="text"
            id="path"
            formControlName="path"
            class="form-input form-input--disabled"
            readonly
          />
        </div>
      </div>

      <div class="form-group form-group--checkbox">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="isLeaf" class="checkbox-input" id="isLeaf" />
          <span class="checkbox-text">{{ 'createSiteForm.isLeafSite' | translate }}</span>
        </label>
      </div>
    </div>

    @if (form.get('isLeaf')?.value) {
    <div class="form-section form-section--leaf">
      <h2 class="form-section__title">{{ 'createSiteForm.parkingDetails' | translate }}</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="pricePerHour" class="form-label"
            >{{ 'createSiteForm.pricePerHour' | translate }} <span class="required">*</span></label
          >
          <input
            type="number"
            id="pricePerHour"
            formControlName="pricePerHour"
            class="form-input"
            [class.form-input--error]="isFieldInvalid('pricePerHour')"
            [placeholder]="'createSiteForm.placeholders.pricePerHour' | translate"
            min="0"
            step="0.01"
          />
          @if (isFieldInvalid('pricePerHour')) {
          <span class="form-error" id="pricePerHour-error">
            @if (form.get('pricePerHour')?.errors?.['required']) {
            {{ 'createSiteForm.errors.priceRequired' | translate }} } @else if
            (form.get('pricePerHour')?.errors?.['min']) {
            {{ 'createSiteForm.errors.priceMin' | translate }}
            <!---->} @else if (form.get('pricePerHour')?.errors?.['maxDecimals']) {
            {{ 'createSiteForm.errors.priceDecimals' | translate }} }
          </span>
          }
        </div>

        <div class="form-group">
          <label for="numberOfSlots" class="form-label"
            >{{ 'createSiteForm.numberOfSlots' | translate }} <span class="required">*</span></label
          >
          <input
            type="number"
            id="numberOfSlots"
            formControlName="numberOfSlots"
            class="form-input"
            [class.form-input--error]="isFieldInvalid('numberOfSlots')"
            [placeholder]="'createSiteForm.placeholders.numberOfSlots' | translate"
            min="1"
            step="1"
          />
          @if (isFieldInvalid('numberOfSlots')) {
          <span class="form-error" id="numberOfSlots-error">
            @if (form.get('numberOfSlots')?.errors?.['required']) {
            {{ 'createSiteForm.errors.slotsRequired' | translate }} } @else if
            (form.get('numberOfSlots')?.errors?.['integer']) {
            {{ 'createSiteForm.errors.slotsInteger' | translate }} } @else if
            (form.get('numberOfSlots')?.errors?.['min']) {
            {{ 'createSiteForm.errors.slotsMin' | translate }}
            <!---->} @else if (form.get('numberOfSlots')?.errors?.['max']) {
            {{ 'createSiteForm.errors.slotsMax' | translate }} }
          </span>
          }
        </div>
      </div>

      <div class="polygons-section">
        <div class="polygons-section__header">
          <h3 class="polygons-section__title">
            {{ 'createSiteForm.polygonsSection' | translate }} <span class="required">*</span>
          </h3>
          <button type="button" class="btn btn--secondary btn--sm" (click)="addPolygon()">
            {{ 'createSiteForm.addPolygon' | translate }}
          </button>
        </div>

        @if (hasPolygonError()) {
        <span class="form-error" id="polygon-error">{{
          'createSiteForm.errors.polygonRequired' | translate
        }}</span>
        }

        <div class="polygons-list" formArrayName="polygons">
          @for (polygon of polygons.controls; track $index; let pIdx = $index) {
          <app-polygon-form
            [polygonGroup]="getPolygonGroup(pIdx)"
            [polygonIndex]="pIdx"
            [canRemove]="polygons.length > 1"
            (remove)="removePolygon(pIdx)"
          />
          }
        </div>
      </div>
    </div>
    }

    <!-- submit Section (this comment to prevent linter from merging @if with line 189) -->
    @if (submitError()) {
    <div class="form-alert form-alert--error" id="backend-error-msg">
      {{ submitError() }}
    </div>
    }

    <div class="form-actions">
      <button
        type="button"
        class="btn btn--secondary"
        (click)="onCancel()"
        [disabled]="submitting()"
        id="cancel-btn"
      >
        {{ 'common.cancel' | translate }}
      </button>
      <button type="submit" class="btn btn--primary" [disabled]="submitting()" id="sub-btn">
        @if (submitting()) { {{ 'createSiteForm.creating' | translate }} } @else {
        {{ 'createSiteForm.createSite' | translate }} }
      </button>
    </div>
  </form>
</section>
